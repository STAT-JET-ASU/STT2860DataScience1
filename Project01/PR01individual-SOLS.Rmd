---
title: "PR01 Individual Time Series Visualizations"
subtitle: "STT2860 Spring 2023"
author: "SOLUTIONS // Jill E. Thomley"
date: "`r format(Sys.time(), '%A, %B %d, %Y @ %I:%M %p')`"
output: 
  html_document: 
    theme: yeti
    highlight: textmate
    code_folding: hide
---
<hr>

```{r globaloptions, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  comment = NA
)
```

### Packages Used

```{r}
library(tidyverse)
```


### Hurricanes Dataset

#### Explore the Data

You can read description of the dataset [HERE](https://stat-jet-asu.github.io/Datasets/InstructorDescriptions/atlantichurricanes18512022.html).

```{r nfl2016}
storms <- read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/atlantichurricanes18512022.csv")
```

Use `glimpse()` to explore the structure of the `storms` dataset.

```{r}
glimpse(storms)
```

#### Time Series Plot of Storms

* The x-axis of the plot in all cases will be the time variable `year`.
* Plot the number of named storms (y) per year (x) using `geom_line()`.
* Add the trend in the number of named storms (y) using `geom_smooth()`.
* Choose and set a color for both the line and trend of named storms.
* Plot the number of major storms (y) per year (x) using `geom_line()`.
* Add the trend in the number of major storms (y) using `geom_smooth()`.
* Choose and set a color for both the line and trend of major storms.
* Add an informative title and appropriate labels for both axes.
* You may optionally add a subtitle or caption for more clarity.
* Add any other formatting you feel will enhance meaning.

**Basic Solution**

```{r}
storms %>%
  ggplot(aes(x = Year)) +
  geom_line(aes(y = Named)) +
  geom_smooth(aes(y = Named), color = "black") +
  geom_line(aes(y = Major), color = "red") +
  geom_smooth(aes(y = Major), color = "red") +
  labs(
    title = "Number of Named Atlantic Storms and Major Hurricanes",
    x = "Years 1851 to 2022",
    y = "Number of Events"
  )
```

**Solution with Extras**

```{r}
storms %>%
  ggplot(aes(x = Year)) +
  geom_line(aes(y = Named), color = "blue") +
  geom_smooth(aes(y = Named), color = "blue") +
  geom_line(aes(y = Major), color = "orange") +
  geom_smooth(aes(y = Major), color = "orange") +
  geom_vline(xintercept = 1975, linetype = "dashed") +
  scale_x_continuous(breaks = seq(from = 1850, to = 2022, by = 10)) +
  scale_y_continuous(breaks = seq(from = 0, to = 32, by = 2)) +
  theme_light() +
  labs(
    title = "Number of Named Atlantic Storms and Major Hurricanes",
    subtitle = "Is the trend in named Atlantic storms picking up speed since the 70s?",
    x = "Years 1851 to 2022",
    y = "Number of Events",
    caption = "the blue trend is all named Atlantic storms\nthe orange trend is major hurricanes only"
  ) +
  annotate("label", x = 1973, y = 28, label = "Change in named storm trend?", hjust = 1)
```

Do you notice any trend(s) in the number of named storms or major hurricanes? Discuss.

**ANSWER:** There has been a slight increase over time in the number of major hurricanes, from about one a year to three or four a year most recently. There has been more of an increase in storms in general, with a sharper increasing trend starting around 1975. At the start of the data in the 1850s there were about six to eight storms a year. Recently there are more than double that.


### Unemployment Dataset

#### Explore the Data

You can read description of the dataset [HERE](https://stat-jet-asu.github.io/Datasets/InstructorDescriptions/unemployment.html).

```{r}
jobless <- read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/unemployment.csv")
```

Use `glimpse()` to explore the structure of the `jobless` dataset.

```{r}
glimpse(jobless)
```

#### Time Series Plot of Unemployment

* Create a line plot for unemployment `rate` (y) by `date` (x).
* Add a filled rectangle to highlight the 1973 to 1975 recession.
* Add a filled rectangle to highlight the 1980 to 1983 recession.
* Add a filled rectangle to highlight the 2007 to 2010 recession.
* Add a filled rectangle to highlight the 2020 to 2021 recession.
* The rectangles should range from 0 to 15 in the y direction.
* Make sure your rectangles do not obscure any other information.
* Add an informative title and appropriate labels for both axes.
* You may optionally add a subtitle or caption for more clarity.
* Be sure to indicate somewhere what the rectangles represent!
* Also be sure to make clear that unemployment rate is a %.
* Add any other formatting you feel will enhance meaning.

**Basic Solution**

```{r}
ggplot(jobless, aes(x = date, y = rate)) +
  geom_line() +
  annotate("rect", xmin = 1973, xmax = 1975, ymin = 0, ymax = 15, alpha = 0.3) +
  annotate("rect", xmin = 1980, xmax = 1983, ymin = 0, ymax = 15, alpha = 0.3) +
  annotate("rect", xmin = 2007, xmax = 2010, ymin = 0, ymax = 15, alpha = 0.3) +
  annotate("rect", xmin = 2020, xmax = 2021, ymin = 0, ymax = 15, alpha = 0.3) +
  labs(
    title = "Monthly Unemployment Rate over Time",
    subtitle = "the shaded areas indicate periods of recession",
    x = "Time (Month and Year)",
    y = "Unemployment Rate (%)"
  )
```

**Solution with Extras**

```{r}
medrate <- jobless %>%
  summarize(medrate = median(rate)) %>%
  pull(medrate)

ggplot(jobless, aes(x = date, y = rate)) +
  annotate("rect", xmin = 1973, xmax = 1975, ymin = 0, ymax = 15, fill = "lightblue") +
  annotate("rect", xmin = 1980, xmax = 1983, ymin = 0, ymax = 15, fill = "lightblue") +
  annotate("rect", xmin = 2007, xmax = 2010, ymin = 0, ymax = 15, fill = "lightblue") +
  annotate("rect", xmin = 2020, xmax = 2021, ymin = 0, ymax = 15, fill = "lightblue") +
  geom_line() +
  geom_hline(yintercept = medrate, linetype = "dashed", color = "blue") +
  scale_x_continuous(breaks = seq(from = 1970, to = 2020, by = 5)) +
  scale_y_continuous(breaks = seq(from = 0, to = 16, by = 1),  limits = c(0, 16), expand = c(0, 0)) +
  theme_linedraw() +
  labs(
    title = "Monthly Unemployment Rate over Time",
    subtitle = "blue shaded areas indicate periods of recession\ndashed line is the median rate across all months",
    x = "Year",
    y = "Unemployment Rate (%)"
  )
```

Do you notice any trend(s) in the unemployment rate related to the recession periods? Discuss.

**ANSWER:** The unemployment rate seems to increase quickly/spike during recessions, then drop again after. 

### Inflation Dataset

#### Explore the Data

You can read description of the dataset [HERE](https://stat-jet-asu.github.io/Datasets/InstructorDescriptions/annualinflation.html).

```{r}
inflate <- read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/annualinflation.csv")
```

Use `glimpse()` to explore the structure of the `inflate` dataset.

```{r}
glimpse(inflate)
```

#### Time Series Plot of Inflation

* Create a time series bar plot for inflation where positive and negative bars are colored differently, as illustrated in Section 3.5 of the [R Graphics Cookbook, 2nd Ed.](https://r-graphics.org/). 
* Use line segment and/or arrow annotation with appropriate text to indicate the span of the Great Depression (1929 to 1939) and the two years with the highest inflation. 
* As always, add an informative title and appropriate labels for both axes, as well as any other formatting you feel will enhance the clarity or meaning if your plot. 
* Be sure a reader can tell from your plot which years are included and which type of inflation value is being displayed (there is more than one way to calculate inflation).

**Basic Solution**

There are many possibilities for labeling the two years with highest inflation; one is shown below.

```{r}
# find highest inflation years
inflate %>% 
  arrange(desc(inflationYOY)) %>% 
  head()
```

```{r}
inflate2 <- inflate %>%
  mutate(pos = inflationYOY >= 0)
```

```{r}
ggplot(inflate2, aes(x = year, y = inflationYOY, fill = pos)) +
  geom_col(color = "black") +
  scale_fill_manual(values = c("lightblue", "orange"), guide = FALSE) +
  # segment span for great depression
  annotate(
    "segment",
    x = 1929,
    xend = 1939,
    y = -0.11,
    yend = -0.11,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm"))
  ) +
  # arrow for top two inflation 1918
  annotate(
    "segment",
    x = 1925,
    xend = 1920,
    y = 0.175,
    yend = 0.175,
    arrow = arrow(length = unit(.2, "cm"))
  ) +
  #  arrow for top two inflation 1946
  annotate(
    "segment",
    x = 1939,
    xend = 1944,
    y = 0.175,
    yend = 0.175,
    arrow = arrow(length = unit(.2, "cm"))
  ) +
  # labels for great depression and arrows
  annotate("label", x = 1940, y = -0.11, label = "Great Depression", hjust = 0) +
  annotate("label", x = 1932, y = 0.19, label = "highest inflation") +
  annotate("label", x = 1932, y = 0.16, label = "1918 and 1946", size = 3) +
  labs(
    title = "Annual Inflation in the United States from 1913 to 2022",
    x = "Year",
    y = "December Year-Over-Year Inflation"
  )
```

**Solution with Extras**

```{r}
ggplot(inflate2, aes(x = year, y = inflationYOY, fill = pos)) +
  geom_col(color = "black") +
  scale_fill_manual(values = c("lightblue", "orange"), guide = FALSE) +
  annotate(
    "segment",
    x = 1929,
    xend = 1939,
    y = -0.11,
    yend = -0.11,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm"))
  ) +
  annotate(
    "segment",
    x = 1925,
    xend = 1920,
    y = 0.175,
    yend = 0.175,
    arrow = arrow(length = unit(.2, "cm"))
  ) +
  annotate(
    "segment",
    x = 1939,
    xend = 1944,
    y = 0.175,
    yend = 0.175,
    arrow = arrow(length = unit(.2, "cm"))
  ) +
  annotate("label", x = 1940, y = -0.11, label = "Great Depression", hjust = 0) +
  annotate("label", x = 1932, y = 0.19, label = "highest inflation") +
  annotate("label", x = 1932, y = 0.16, label = "1918 and 1946", size = 3) +
  scale_x_continuous(breaks = seq(from = 1910, to = 2030, by = 10)) +
  scale_y_continuous(breaks = seq(from = -0.1, to = 0.2, by = 0.05), labels = scales::percent_format()) +
  labs(
    title = "Annual Inflation in the United States from 1913 to 2022",
    x = "Year",
    y = "December Year-Over-Year Inflation"
  ) +
  theme_minimal()
```

Discuss two interesting or surprising features of this plot.

**ANSWER:** Some possiilities...

* Present-day inflation isn't nearly the highest we have ever had. In the past there have been instances of double (and almost triple) inflation compared to the two most recent years. 
* Inflation in the last two years is the first time the rate exceeded 5% since the start of the 1990s.
* There hasn't been a year with negative inflation (deflation) since the first half of the 1950s.
* The highest periods of inflation seem to be around the two world wars and in the 1970s.
* There was more variation in inflation prior to the 1990s than after (until recently...).

<hr>

```{r}
sessionInfo()
```

