---
title: "Worksheet/Homework: Reshaping Data #1"
subtitle: "STT 2860 Intro to Data Mgmt & Visualization" 
author: "PUT YOUR NAME HERE"
date: "`r format(Sys.time(), '%A, %B %d, %Y @ %I:%M %p')`"
output: 
  html_document: 
    theme: yeti
    highlight: textmate
    toc: true
    toc_depth: 4 
---

```{r globaloptions, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  comment = NA
)
```

***

### Packages Used

```{r}
# load all packages used here
library(tidyverse)
library(HistData)
```

### Using `pivot_longer()`

Reference: https://tidyr.tidyverse.org/reference/pivot_longer.html

This used to be called `gather()`.

#### Powerball Data

Read the Data
```{r}
powdata <- 
  read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/powerballnumbers.csv") %>% 
  select(-multiplier)
```

Explore the Structure
```{r}
glimpse(powdata)
head(powdata)
```

#### Gather the Numbers

Use `pivot_longer()` to gather the six number columns into the columns `ballrank` and `ballnum`.

```{r}
powerdata_long <- powdata %>% 
  pivot_longer(
    cols = low:powerball,
    names_to = "ballrank", # this is the column that low, second, etc. will go to
    values_to = "ballnum", # this is the column that the data values will go to
  )
```

#### Summaries of the Numbers

Unpivoted Data
```{r}
powdata %>%
  summarize(
    mean_low = mean(low),
    mean_2nd = mean(second),
    mean_3rd = mean(third),
    mean_4th = mean(fourth),
    mean_hgh = mean(high),
    mean_pow = mean(powerball)
  )
```

Pivoted Data
```{r}
powerdata_long %>% 
  group_by(ballrank) %>% 
  summarize(ballmean = mean(ballnum),
            ballsd = sd(ballnum))
```

#### Plots of the Numbers

Unpivoted Data
```{r}
powdata %>%
  filter(year == 2017) %>%
  ggplot(aes(x = as.Date(drawdate, format = "%m/%d/%Y"))) +
  geom_smooth(mapping = aes(y = low), se = FALSE, color = "red") +
    geom_point(mapping = aes(y = low), color = "red", alpha = 0.25, size = 2) +
  geom_smooth(mapping = aes(y = second), se = FALSE, color = "orange") +
    geom_point(mapping = aes(y = second), color = "orange", alpha = 0.25, size = 2) +
  geom_smooth(mapping = aes(y = third), se = FALSE, color = "yellow") +
    geom_point(mapping = aes(y = third), color = "yellow", alpha = 0.25, size = 2) +
  geom_smooth(mapping = aes(y = fourth), se = FALSE, color = "green") +
    geom_point(mapping = aes(y = fourth), color = "green", alpha = 0.25, size = 2) +
  geom_smooth(mapping = aes(y = high), se = FALSE, color = "blue") +
    geom_point(mapping = aes(y = high), color = "blue", alpha = 0.25, size = 2) +
  theme_minimal() +
  labs(
    title = "Powerball Numbers for Each Drawing in 2017",
    subtitle = "Each Week's White Ball Numbers, Smallest to Largest",
    caption = "color code: red = 1st (smallest), orange = 2nd, yellow = third, green = 4th, blue = 5th (largest)",
    x = "Date",
    y = "Ball Number"
  )
```

Pivoted Data
```{r}
powerdata_long %>%
  filter(year == 2017, ballrank != "powerball") %>%
  mutate(ballrank = factor(ballrank, levels = c("low", "second", "third", "fourth", "high"))) %>%
  ggplot(aes(x = as.Date(drawdate, format = "%m/%d/%Y"), y = ballnum, color = ballrank)) +
  geom_smooth(se = FALSE) +
  geom_point(alpha = 0.25, size = 2) +
  scale_color_manual(values = c("red", "orange", "yellow", "green", "blue")) +
  labs(
    title = "Powerball Numbers for Each Drawing in 2017",
    subtitle = "Each Week's White Ball Numbers, Smallest to Largest",
    x = "Date",
    y = "Ball Number",
    color = "Rank of Ball"
  )
```

#### Consumer Price Index Data

Read the Data
```{r}
cpidata <- read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/cpidata2022.csv")
```

Explore the Structure
```{r}

```

#### Gather the Months

Use `pivot_longer()` to gather the twelve month columns into the columns `month` and `cpivalue`.

```{r}

```

### Using `pivot_wider()`

Reference: https://tidyr.tidyverse.org/reference/pivot_wider.html

#### Farr's 1849 Deaths

Read the Data
```{r}
choldata <- CholeraDeaths1849
choldata
```

Explore the Structure
```{r}
glimpse(choldata)
head(choldata)
```

#### Spread the Causes of Death

Spread the data so that the `deaths` for the two `cause_of_death` are in different columns.

```{r}
choldata_wide <- choldata %>% 
  pivot_wider(
    names_from = cause_of_death,
    values_from = deaths
  )
glimpse(choldata_wide)
```

#### Vietnam Draft Data

Read the Data
```{r}
draftdata <- read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/vietnamdraft.csv")
```

Explore the Structure
```{r}
glimpse(draftdata)
head(draftdata)
```

#### Spread Draft Numbers 

Spread the data so that the `draftnumber` for each `draftyear` are in different columns.

```{r}
draftdata %>% 
  count(draftyear)

draftdata %>% 
  count(drawyear)
```
    
    
```{r}
draftdata %>% 
  pivot_wider(
    id_cols = c(month, day, halfyear),
    names_from = c(draftyear),
    values_from = c(draftnumber, birthyear),
    names_prefix = "dy"
  )
```

#### Semmelweis Clinics

Read the Data
```{r}
semdata <- 
  read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/semmelweisannualbyclinic.csv")
```

Explore the Structure
```{r}

```

#### Spread the Clinics

Spread the data so that the `births` and `deaths` for the two clinics are in different columns.

```{r}

```

### Using `separate_wider_*()` and `unite()`

Reference: 

* https://tidyr.tidyverse.org/reference/separate_wider_delim.html
* https://tidyr.tidyverse.org/reference/unite.html

#### Our Class Data

Read the Data
```{r}
classdata <- read_csv("https://raw.githubusercontent.com/STAT-JET-ASU/STT2860DataScience1/main/Worksheets/stt2860fall2023.csv")
```

Explore the Structure
```{r}
glimpse(classdata)
head(classdata)
```

#### first operation here 

Separate the names into Last and First-MI.

```{r}
classdata %>% 
  separate_wider_delim(
    cols = Name,
    delim = ", ",
    names = c("Last", "First"),
    cols_remove = FALSE
  )
```

```{r}
classdata %>% 
  separate_wider_delim(
    cols = Name,
    delim = ", ",
    names = c("Last", "First"),
    cols_remove = FALSE
  ) %>% 
  separate_wider_delim(
    cols = MajorConc,
    delim = ", ",
    names = c("Major", "Concentration"),   
    too_few = "align_start"
  )
```

#### second operation here 

```{r}
classdata %>%
  separate_wider_delim(
    cols = MajorConc,
    delim = ", ",
    names = c("Major", "Concentration"),   
    too_few = "debug"
  )
```

```{r}
classdataA <- classdata %>% 
  separate_wider_delim(
    cols = Name,
    delim = ", ",
    names = c("Last", "First")
  )

classdataB <- classdataA %>% 
  separate_wider_delim(
    cols = First,
    delim = " ",
    names = c("Given", "MI"),
    too_few = "align_start"
  )
classdataB
```

Separate the `Email` column to obtain loginID, but keep email also.

```{r}
classdataB %>% 
  separate_wider_delim(
    cols = Email,
    delim = "@",
    names = c("loginID", "TheRest"),
    cols_remove = FALSE
  )
```

```{r}
classdataB %>% 
  separate_wider_delim(
    cols = Email,
    delim = "@",
    names = c("loginID"),
    too_many = "drop",
    cols_remove = FALSE
  ) 
```

#### Unite!

```{r}
classdataB %>% 
  unite(
    col = "Fullname",
    c(Given, MI, Last),
    sep = " ",
    na.rm = TRUE,
    remove = FALSE
  ) %>% 
  mutate(FullnameLC = tolower(Fullname))

```



***
```{r}
sessionInfo()
```

